<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Tnt4j-log4j12 by Nastel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Tnt4j-log4j12</h1>
      <h2 class="project-tagline">Log4J 1.2  Appender for TNT4J</h2>
      <a href="https://github.com/Nastel/tnt4j-log4j12" class="btn">View on GitHub</a>
      <a href="https://github.com/Nastel/tnt4j-log4j12/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Nastel/tnt4j-log4j12/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="tnt4j-log4j12" class="anchor" href="#tnt4j-log4j12" aria-hidden="true"><span class="octicon octicon-link"></span></a>tnt4j-log4j12</h1>

<p>Log4J 1.2  Appender for TNT4J</p>

<h3>
<a id="log4j-appender" class="anchor" href="#log4j-appender" aria-hidden="true"><span class="octicon octicon-link"></span></a>LOG4J Appender</h3>

<p>All LOG4J messages can be routed to TNt4J event sinks via <code>TNT4JAppender</code> for Log4J, 
which allows developers to send event messages to TNT4J.</p>

<p>Developers may also enrich event messages and pass context to TNT4J using hash tag enrichment scheme.
Hash tags are used to decorate event messages with important meta data about each log message. 
This meta data is used to generate TNT4J tracking events:</p>

<div class="highlight highlight-source-java"><pre>logger<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">"</span>Starting a tnt4j activity #beg=Test, #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName());
logger<span class="pl-k">.</span>warn(<span class="pl-s"><span class="pl-pds">"</span>First log message #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, #msg='1 Test warning message'<span class="pl-pds">"</span></span>);
logger<span class="pl-k">.</span>error(<span class="pl-s"><span class="pl-pds">"</span>Second log message #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>, #msg='2 Test error message'<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">Exception</span>(<span class="pl-s"><span class="pl-pds">"</span>test exception<span class="pl-pds">"</span></span>));
logger<span class="pl-k">.</span>info(<span class="pl-s"><span class="pl-pds">"</span>Ending a tnt4j activity #end=Test, #app=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Log4JTest</span><span class="pl-k">.</span>class<span class="pl-k">.</span>getName() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> #%i/order-no=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> orderNo  <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span> #%d:currency/amount=<span class="pl-pds">"</span></span> <span class="pl-k">+</span> amount);</pre></div>

<p>Above example groups messages between first and last into a related logical collection called <code>Activity</code>. Activity is a collection of logically related events/messages. Hash tags <code>#beg</code>, <code>#end</code> are used to demarcate activity boundaries. This method also supports nested activities.</p>

<p>User defined fields can be reported using <code>#[data-type][:value-type]/your-metric-name=your-value</code> convention (e.g. <code>#%i/order-no=62627</code> or <code>#%d:currency/amount=50.45</code>). 
<code>TNT4JAppender</code> supports the following optional <code>data-type</code> qualifiers:</p>

<pre><code>    %i/ -- integer
    %l/ -- long
    %d/ -- double
    %f/ -- float
    %b/ -- boolean
    %n/ -- number
    %s/ -- string
</code></pre>

<p>All <code>value-type</code> qualifiers are defined in <code>com.nastel.jkool.tnt4j.core.ValueTypes</code>. Examples:</p>

<pre><code>    currency    -- generic currency
    flag        -- boolean flag
    age         -- age in time units
    guid        -- globally unique identifier
    guage       -- numeric gauge
    counter     -- numeric counter
    percent     -- percent
    timestamp   -- timestamp
    addr        -- generic address
</code></pre>

<p>Not specifying a qualifier defaults to auto detection of type by <code>TNT4JAppender</code>. 
First <code>number</code> qualifier is tested and defaults to <code>string</code> if the test fails (e.g. <code>#order-no=62627</code>).
User defined fields are reported as a TNT4J snapshot with <code>Log4j</code> category and snapshot name set to 
activity name set by <code>#beg</code>, <code>#end</code>, <code>#opn</code> tags.</p>

<p>Below is a sample log4j appender configuration:</p>

<pre><code>### Default TNT4J Appender configuration
log4j.appender.tnt4j=com.nastel.jkool.tnt4j.logger.log4j.TNT4JAppender
log4j.appender.tnt4j.SourceName=com.log4j.Test
log4j.appender.tnt4j.SourceType=APPL
log4j.appender.tnt4j.MetricsOnException=true
log4j.appender.tnt4j.MetricsFrequency=60
log4j.appender.tnt4j.layout=org.apache.log4j.PatternLayout
log4j.appender.tnt4j.layout.ConversionPattern=%d{ABSOLUTE} %-5p [%c{1}] %m%n
</code></pre>

<h1>
<a id="running-samples" class="anchor" href="#running-samples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Running Samples</h1>

<ul>
<li>Simple TNT4J Sample application (<code>com.nastel.jkool.tnt4j.examples.TNT4JTest</code>):</li>
</ul>

<div class="highlight highlight-source-java"><pre>java <span class="pl-k">-</span>javaagent<span class="pl-k">:</span>tnt4j<span class="pl-k">-</span>api<span class="pl-k">.</span>jar <span class="pl-k">-</span><span class="pl-smi">Dtnt4j</span><span class="pl-k">.</span>config<span class="pl-k">=</span>config<span class="pl-k">/</span>tnt4j<span class="pl-k">.</span>properties <span class="pl-k">-</span><span class="pl-smi">Dtnt4j</span><span class="pl-k">.</span>token<span class="pl-k">.</span>repository<span class="pl-k">=</span>config<span class="pl-k">/</span>tnt4j<span class="pl-k">-</span>tokens<span class="pl-k">.</span>properties  <span class="pl-k">-</span><span class="pl-smi">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>on<span class="pl-k">.</span>vm<span class="pl-k">.</span>shutdown<span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-smi">Dtnt4j</span><span class="pl-k">.</span>dump<span class="pl-k">.</span>provider<span class="pl-k">.</span><span class="pl-k">default</span><span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span><span class="pl-smi">Dtnt4j</span><span class="pl-k">.</span>formatter<span class="pl-k">.</span>json<span class="pl-k">.</span>newline<span class="pl-k">=</span><span class="pl-c1">true</span> <span class="pl-k">-</span>classpath tnt4j<span class="pl-k">-</span>api<span class="pl-k">-</span><span class="pl-k">final</span><span class="pl-k">-</span>all<span class="pl-k">.</span>jar <span class="pl-smi">com.nastel.jkool.tnt4j.examples<span class="pl-k">.</span>TNT4JTest</span> <span class="pl-smi">com.myco<span class="pl-k">.</span>TestApp</span> <span class="pl-c1">MYSERVER</span> <span class="pl-s"><span class="pl-pds">"</span>Test log message<span class="pl-pds">"</span></span> correlator1 <span class="pl-s"><span class="pl-pds">"</span>TestCommand<span class="pl-pds">"</span></span>  <span class="pl-smi">TestLocation</span></pre></div>

<p><b>Command line arguments:</b></p>

<ul>
<li>
<code>-javaagent:tnt4j-api.jar</code> command line option is required by <code>ObjectDumpProvider</code> to calculate object deep and shallow memory sizes. Use this only if your application makes use of <code>ObjectDumpProvider</code> to dump object state.</li>
<li>
<code>-Dtnt4j.dump.on.vm.shutdown=true</code> java property allows application state dumps generated automatically upon VM shutdown.</li>
<li>
<code>-Dtnt4j.dump.provider.default=true</code> java property registers all default dump providers (memory, stack, logging stats).</li>
<li>
<code>-Dtnt4j.formatter.json.newline=true</code> java property directs <code>JSONFormatter</code> to append new line when formatting log entries.</li>
</ul>

<p>See <code>&lt;timestamp&gt;.log</code> and <code>&lt;vmid&gt;.dump</code> file for output produced by <code>com.nastel.jkool.tnt4j.examples.TNT4JTest</code>.
See <code>config/tnt4j.properties</code> for TNT4J configuration: factories, formatters, listeners, etc. See Wiki for more information.</p>

<h1>
<a id="how-to-build-tnt4j-log4j12" class="anchor" href="#how-to-build-tnt4j-log4j12" aria-hidden="true"><span class="octicon octicon-link"></span></a>How to Build tnt4j-log4j12</h1>

<p>Requirements</p>

<ul>
<li>JDK 1.7+</li>
<li>ANT (<a href="http://ant.apache.org/">http://ant.apache.org/</a>)</li>
</ul>

<p>TNT4J-LOG4J12 depends on the following external packages:</p>

<ul>
<li>TNT4J-API (<a href="http://nastel.github.io/TNT4J/">http://nastel.github.io/TNT4J/</a>)</li>
<li>Apache Log4J 1.2.17 (<a href="http://logging.apache.org/log4j/1.2/">http://logging.apache.org/log4j/1.2/</a>)</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Nastel/tnt4j-log4j12">Tnt4j-log4j12</a> is maintained by <a href="https://github.com/Nastel">Nastel</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
